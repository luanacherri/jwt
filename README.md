# JWT Validator API

[![GitHub Repository](https://img.shields.io/badge/github-repository-green.svg)](https://github.com/luana/jwt-validator)

## Reposit√≥rio
O c√≥digo fonte est√° dispon√≠vel em: [https://github.com/luana/jwt-validator](https://github.com/luana/jwt-validator)

## Descri√ß√£o
API REST para valida√ß√£o de JWTs (JSON Web Tokens) que verifica o formato e valida claims obrigat√≥rios seguindo regras espec√≠ficas de neg√≥cio. O projeto implementa uma solu√ß√£o completa com observabilidade, logs estruturados e monitoramento.

## üöÄ Tecnologias Utilizadas
- Java 21
- Spring Boot 3.2.2
- OpenTelemetry para observabilidade
- Logback para logging estruturado
- Prometheus + Grafana para m√©tricas
- Jaeger para tracing distribu√≠do
- Docker e Docker Compose para containeriza√ß√£o

## ‚öôÔ∏è Pr√©-requisitos
- Java 21+
- Maven 3.8+
- Docker e Docker Compose

## üèÉ‚Äç‚ôÇÔ∏è Como Executar

### Via Docker Compose (Recomendado)
1. Clone o reposit√≥rio:
```bash
git clone https://github.com/luana/jwt-validator.git
cd jwt-validator
```

2. Execute:
```bash
docker-compose up -d
```

Os servi√ßos estar√£o dispon√≠veis em:
- JWT Validator: http://localhost:8081
- Swagger UI: http://localhost:8081
- Jaeger UI: http://localhost:16686
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000 (usu√°rio: admin, senha: admin)

### Via Maven
1. Clone o reposit√≥rio
2. Execute:
```bash
./mvnw spring-boot:run
```

## üìö API Endpoints

### POST /api/v1/jwt/validate
Valida um JWT verificando seu formato e claims obrigat√≥rios.

#### Request
```json
{
    "jwt": "eyJhbGciOiJIUzI1NiJ9.eyJSb2xlIjoiQWRtaW4iLCJTZWVkIjoiNzg0MSIsIk5hbWUiOiJUb25pbmhvIEFyYXVqbyJ9.QY05sIjtrcJnP533kQNk8QXcaleJ1Q01jWY_ZzIZuAg"
}
```

#### Response Success (200 OK)
```json
{
    "valid": true,
    "type": "https://api.validator.com/jwt/valid",
    "title": "JWT V√°lido"
}
```

#### Response Error (400 Bad Request)
```json
{
    "valid": false,
    "type": "https://api.validator.com/problems/invalid-jwt",
    "title": "JWT Inv√°lido",
    "detail": "Claim 'Name' √© inv√°lido"
}
```

## üìã Regras de Valida√ß√£o

### Claims Obrigat√≥rios
O JWT deve conter exatamente 3 claims que s√£o validados conforme as seguintes regras:

1. **Name**
   - N√£o pode conter n√∫meros
   - Tamanho m√°ximo de 256 caracteres
   - Case sensitive
   - Deve ser uma string n√£o vazia

2. **Role**
   - Valores permitidos: "Admin", "Member", "External"
   - Case sensitive
   - Deve ser exatamente um dos valores permitidos

3. **Seed**
   - Deve ser um n√∫mero primo
   - Deve ser um valor num√©rico v√°lido
   - N√£o pode ser negativo

## üîç Observabilidade

### Logs
- Logs estruturados em formato JSON
- Rota√ß√£o de logs di√°ria com arquivamento
- Local: ./logs/jwt-validator.log
- Reten√ß√£o: 30 dias
- Limite total: 3GB
- N√≠veis configurados por pacote
- MDC com request ID

### Tracing (Jaeger)
- UI: http://localhost:16686
- Features:
  - Propaga√ß√£o de contexto via B3
  - Rastreamento de requisi√ß√µes HTTP
  - Spans personalizados para valida√ß√µes
  - Anota√ß√µes para opera√ß√µes importantes
  - M√©tricas de lat√™ncia

### M√©tricas (Prometheus + Grafana)
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000
- M√©tricas dispon√≠veis:
  - JVM (heap, threads, gc)
  - HTTP (lat√™ncia, c√≥digos de resposta)
  - Sistema (CPU, mem√≥ria)
  - Neg√≥cio (valida√ß√µes/s, erros/s)

## üìÑ Documenta√ß√£o API
Swagger UI dispon√≠vel em: http://localhost:8081

O Swagger inclui:
- Descri√ß√£o detalhada dos endpoints
- Schemas dos requests/responses
- Exemplos de payloads
- C√≥digos de resposta poss√≠veis
- Try-out interativo

## ü§î Premissas Assumidas

1. **Formato e Valida√ß√£o do JWT**
   - JWT deve seguir o formato padr√£o com 3 partes separadas por "."
   - Payload deve ser um JSON v√°lido em Base64
   - Valida√ß√£o fail-fast: primeira falha interrompe o processo
   - Claims s√£o case-sensitive para garantir precis√£o
   - N√£o √© necess√°rio validar a assinatura do token

2. **Performance e Escalabilidade**
   - Valida√ß√µes s√£o executadas em mem√≥ria
   - Sem persist√™ncia de dados necess√°ria
   - Cache n√£o implementado por ser stateless
   - Pronto para containeriza√ß√£o e orquestra√ß√£o

3. **Observabilidade**
   - Request ID gerado para cada requisi√ß√£o
   - Correla√ß√£o entre logs, m√©tricas e traces
   - Reten√ß√£o de 30 dias baseada em pr√°ticas comuns
   - Granularidade de logs por pacote para debug

4. **Seguran√ßa**
   - CORS habilitado para facilitar testes
   - Rate limiting n√£o implementado (pode ser adicionado se necess√°rio)
   - Foco na valida√ß√£o estrutural do JWT

## üèóÔ∏è Princ√≠pios SOLID Aplicados

### Single Responsibility Principle (SRP)
- `JwtController`: Respons√°vel apenas pela exposi√ß√£o da API REST
- `JwtValidationService`: Coordena o processo de valida√ß√£o
- Classes espec√≠ficas para cada tipo de valida√ß√£o:
  - `NameValidator`: Valida√ß√£o espec√≠fica do claim Name
  - `RoleValidator`: Valida√ß√£o espec√≠fica do claim Role
  - `SeedValidator`: Valida√ß√£o espec√≠fica do claim Seed
- `TracingFilter`: Respons√°vel apenas pelo trace das requisi√ß√µes

### Open/Closed Principle (OCP)
- Interface `ClaimValidator` permite adicionar novas valida√ß√µes sem modificar c√≥digo existente
- `ValidatorChain` permite extens√£o das regras de valida√ß√£o
- `OpenTelemetryConfig` extens√≠vel para novos exporters
- Sistema de observabilidade permite adi√ß√£o de novas m√©tricas sem altera√ß√£o do c√≥digo base

### Liskov Substitution Principle (LSP)
- Todos os validators implementam a interface `ClaimValidator`
- Possibilidade de trocar implementa√ß√µes sem afetar o comportamento do sistema
- Implementa√ß√µes de ExceptionHandler seguem contratos consistentes
- Testes unit√°rios validam comportamento consistente entre implementa√ß√µes

### Interface Segregation Principle (ISP)
- Interface `ClaimValidator` enxuta e focada
- Separa√ß√£o clara entre interfaces de valida√ß√£o e interfaces de servi√ßo
- `TracingInterceptor` com interfaces espec√≠ficas para seu prop√≥sito
- DTOs espec√≠ficos para cada tipo de opera√ß√£o

### Dependency Inversion Principle (DIP)
- Servi√ßos dependem de abstra√ß√µes (`ClaimValidator`) e n√£o implementa√ß√µes
- Inje√ß√£o de depend√™ncias via Spring Framework
- Configura√ß√µes abstra√≠das em interfaces
- Uso de factories para cria√ß√£o de objetos complexos

Os princ√≠pios SOLID foram fundamentais na arquitetura do projeto, garantindo:
- C√≥digo mais manuten√≠vel e test√°vel
- Facilidade para adicionar novas funcionalidades
- Redu√ß√£o de acoplamento entre componentes
- Melhor organiza√ß√£o e coes√£o do c√≥digo

## üß™ Testes

### Executando os Testes
```bash
./mvnw test
```

### Cobertura de Testes
O projeto possui testes unit√°rios e de integra√ß√£o cobrindo os principais cen√°rios:

#### Testes Unit√°rios
- `JwtValidationServiceTest`: Testes da l√≥gica de valida√ß√£o dos claims
  - Valida√ß√£o do formato do JWT
  - Valida√ß√£o do claim Name (caracteres especiais, n√∫meros, tamanho)
  - Valida√ß√£o do claim Role (valores permitidos)
  - Valida√ß√£o do claim Seed (n√∫meros primos)
  - Cen√°rios de erro e exce√ß√µes

#### Testes de Integra√ß√£o
- `JwtControllerIntegrationTest`: Testes end-to-end da API
  - Valida√ß√£o de JWTs v√°lidos
  - Valida√ß√£o de erros de formato
  - Valida√ß√£o de claims inv√°lidos
  - Verifica√ß√£o de respostas HTTP
  - Headers e content types corretos

### Fixtures e Test Helpers
- Builders para cria√ß√£o de JWTs de teste
- Fixtures com tokens v√°lidos e inv√°lidos
- Utilit√°rios para gera√ß√£o de tokens de teste

### Relat√≥rios de Teste
Os relat√≥rios de teste podem ser encontrados em:
- Relat√≥rios Surefire: `target/surefire-reports/`
- Relat√≥rios de Cobertura: `target/site/jacoco/`

### Integra√ß√£o com CI/CD
Os testes s√£o executados automaticamente:
- Em cada commit
- Antes da gera√ß√£o de uma nova build
- Como parte do pipeline de CI/CD

## üõ†Ô∏è Ferramentas de Teste

### Insomnia
Uma cole√ß√£o do Insomnia est√° dispon√≠vel para testar a API facilmente.

#### Importando a Cole√ß√£o
1. Abra o Insomnia
2. Clique em `Create` > `Import From` > `File`
3. Selecione o arquivo `insomnia_collection.json` do projeto
4. Clique em `Import`

#### Requests Dispon√≠veis
1. **Validar JWT (V√°lido)**
   - Exemplo de JWT v√°lido com todas as claims corretas
   - Role: "Admin", Seed: "7841" (primo), Name: "Toninho Araujo"

2. **Validar JWT (Nome Inv√°lido)**
   - Exemplo com nome contendo n√∫meros
   - Role: "External", Seed: "88037", Name: "M4ria Olivia"

3. **Validar JWT (Role Inv√°lida)**
   - Exemplo com role n√£o permitida
   - Role: "User" (n√£o permitido)

4. **Validar JWT (Seed Inv√°lido)**
   - Exemplo com n√∫mero n√£o primo
   - Seed: "100" (n√£o √© primo)

5. **Health Check**
   - Verifica o status da aplica√ß√£o
   - Endpoint: GET /actuator/health

### Postman
Uma cole√ß√£o do Postman tamb√©m est√° dispon√≠vel para testar a API.

#### Importando a Cole√ß√£o
1. Abra o Postman
2. Clique em `Import` > `File`
3. Selecione o arquivo `postman_collection.json` do projeto
4. Clique em `Import`

#### Requests Dispon√≠veis
1. **Validar JWT (V√°lido)**
   - Exemplo de JWT v√°lido com todas as claims corretas
   - Role: "Admin", Seed: "7841" (primo), Name: "Toninho Araujo"

2. **Validar JWT (Nome Inv√°lido)**
   - Exemplo com nome contendo n√∫meros
   - Role: "External", Seed: "88037", Name: "M4ria Olivia"

3. **Validar JWT (Role Inv√°lida)**
   - Exemplo com role n√£o permitida
   - Role: "User" (n√£o permitido)

4. **Validar JWT (Seed Inv√°lido)**
   - Exemplo com n√∫mero n√£o primo
   - Seed: "100" (n√£o √© primo)

5. **Health Check**
   - Verifica o status da aplica√ß√£o
   - Endpoint: GET /actuator/health

### Curl
Voc√™ tamb√©m pode usar curl para testar a API. Exemplos:

```bash
# Health Check
curl http://localhost:8081/actuator/health

# Validar JWT
curl -X POST http://localhost:8081/api/v1/jwt/validate \
  -H "Content-Type: application/json" \
  -d '{"jwt": "eyJhbGciOiJIUzI1NiJ9.eyJSb2xlIjoiQWRtaW4iLCJTZWVkIjoiNzg0MSIsIk5hbWUiOiJUb25pbmhvIEFyYXVqbyJ9.QY05sIjtrcJnP533kQNk8QXcaleJ1Q01jWY_ZzIZuAg"}'
```

### Swagger UI
A documenta√ß√£o interativa da API est√° dispon√≠vel em http://localhost:8081/

- Documenta√ß√£o completa dos endpoints
- Interface para testar as requisi√ß√µes
- Exemplos de requests e responses
- Descri√ß√£o dos c√≥digos de erro

### Monitoramento

1. **Jaeger UI (Tracing)**
   - URL: http://localhost:16686
   - Visualize traces distribu√≠dos
   - An√°lise de lat√™ncia
   - Debugging de requisi√ß√µes

2. **Prometheus (M√©tricas)**
   - URL: http://localhost:9090
   - M√©tricas da aplica√ß√£o
   - Queries personalizadas
   - Alertas configur√°veis

3. **Grafana (Dashboards)**
   - URL: http://localhost:3000
   - Login: admin/admin
   - Visualiza√ß√£o de m√©tricas
   - Dashboards personalizados

## üèóÔ∏è Estrutura do Projeto
```
jwt-validator/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/com/example/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/              # Configura√ß√µes Spring e Infra
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ JacksonConfig.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MetricsConfig.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OpenTelemetryConfig.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WebConfig.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/          # Controllers REST
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ JwtController.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ service/             # L√≥gica de Neg√≥cio
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ JwtValidationService.java
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ validator/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.properties
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ logback-spring.xml
‚îÇ   ‚îî‚îÄ‚îÄ test/                        # Testes
‚îú‚îÄ‚îÄ docker-compose.yml               # Defini√ß√£o dos servi√ßos
‚îú‚îÄ‚îÄ Dockerfile                       # Build da aplica√ß√£o
‚îî‚îÄ‚îÄ prometheus.yml                   # Config do Prometheus
```

